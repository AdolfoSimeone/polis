{{> top}}

<body>
<style>
input::-webkit-input-placeholder {
  color: rgba(255,255,255,.6);
}
input::-moz-placeholder {
  color: rgba(255,255,255,.6);
}
input:-ms-input-placeholder {
  color: rgba(255,255,255,.6);
}
.navIcon {
  color: white;
}
.header {
  display: inline-block;
  margin: 5px;
}
.HeaderLink {
  text-decoration: none;
  color: rgba(255,255,255,0.8);
  /*text-transform: uppercase;*/
}
.HeaderLink:hover {
  color: white;
}
</style>

<script>
function setCookie(cname,cvalue,exdays) {
    var d = new Date();
    d.setTime(d.getTime()+(exdays*24*60*60*1000));
    var expires = "expires="+d.toGMTString();
    document.cookie = cname + "=" + cvalue + "; " + expires;
}

function getCookie(cname) {
    var name = cname + "=";
    var ca = document.cookie.split(';');
    for(var i=0; i<ca.length; i++)
      {
      var c = ca[i].trim();
      if (c.indexOf(name)==0) return c.substring(name.length,c.length);
    }
    return "";
}
if (!getCookie("ref")) {
    setCookie("ref", document.referrer, 365);
}

$(document).ready(function() {
  if (getCookie("uid2")) {
    $(".ifAuth").fadeIn();
  } else {
    $(".ifNoAuth").fadeIn();
  }
});

//FB
function getFriends() {
  var dfd = $.Deferred();

  function getMoreFriends(friendsSoFar, urlForNextCall) {
    console.log("getMoreFriends");

    return $.get(urlForNextCall).then(function(response) {
      if (response.data.length) {
        for (var i = 0; i < response.data.length; i++) {
          friendsSoFar.push(response.data[i]);
        }
        if (response.paging.next) {
          return getMoreFriends(friendsSoFar, response.paging.next);
        }
        return friendsSoFar;
      } else {
        return friendsSoFar;
      }
    });
  }

  FB.api('/me/friends',function (response) {
    console.log("/me/friends returned");
    if (response && !response.error) {
      // alert(JSON.stringify(response));
      // if (response.data) {
      //   for (var i = 0; i < response.data.length; i++) {
      //     alert(response.data[i]);
      //   }
      // }

      var friendsSoFar = response.data;
      if (response.data.length && response.paging.next) {
        getMoreFriends(friendsSoFar, response.paging.next).then(
          dfd.resolve,
          dfd.reject);
      } else {
        dfd.resolve(friendsSoFar || []);
      }
    } else {
      // alert('failed to find friends');
      dfd.reject(response);
    }
  });
  return dfd.promise();
} // end getFriends

function getInfo() {
  var dfd = $.Deferred();

  FB.api('/me',function (response) {
    console.log("/me done");
    // {"id":"10152802017421079"
    //   "email":"michael@bjorkegren.com"
    //   "first_name":"Mike"
    //   "gender":"male"
    //   "last_name":"Bjorkegren"
    //   "link":"https://www.facebook.com/app_scoped_user_id/10152802017421079/"
    //   "locale":"en_US"
    //   "location": {
    //      "id": "110843418940484",  ------------> we can make another call to get the lat,lng for this
    //      "name": "Seattle, Washington"
    //   },
    //   "name":"Mike Bjorkegren"
    //   "timezone":-7
    //   "updated_time":"2014-07-03T06:38:02+0000"
    //   "verified":true}

    if (response && !response.error) {
      // alert(JSON.stringify(response));
      // if (response.data) {
      //   for (var i = 0; i < response.data.length; i++) {
      //     alert(response.data[i]);
      //   }
      // }

      if (response.location && response.location.id) {
        FB.api('/' + response.location.id, function(locationResponse) {
          console.log("locationResponse");
          console.dir(locationResponse);
          if (locationResponse) {
            response.locationInfo = locationResponse;
          }
          dfd.resolve(response);
        });
      } else {
        dfd.resolve(response);
      }
    } else {
      // alert('failed to find data');
      dfd.reject(response);
    }
  });
  return dfd.promise();
} // end getInfo






function facebookLoginOkHandler(response, optionalPassword) {
  console.log("onFbLoginOk");
  console.dir(response);
  return $.when(
    getInfo(),
    getFriends()).then(function(fb_public_profile, friendsData) {

      // alert(JSON.stringify(friendsData));
      console.log("got info and friends");

      var data = {
          // fb_user_id: FB.getUserID(),
          // fb_login_status: FB.getLoginStatus(),
          // fb_auth_response: JSON.stringify(FB.getAuthResponse()),
          // fb_access_token: FB.getAccessToken(),
          fb_public_profile: JSON.stringify(fb_public_profile),
          fb_friends_response: JSON.stringify(friendsData),
          response: JSON.stringify(response)
      };
      if (fb_public_profile.email) {
        data.fb_email = fb_public_profile.email;
      } else {
        data.provided_email = prompt("Please enter your email address.");
      }
      var hname = [fb_public_profile.first_name, fb_public_profile.last_name].join(" ");
      if (hname.length) {
        data.hname = hname;
      }
      if (response && response.authResponse && response.authResponse.grantedScopes) {
        data.fb_granted_scopes = response.authResponse.grantedScopes;
      }
      if (optionalPassword) {
        data.password = optionalPassword;
      }

      return $.ajax({
        url: "/api/v3/auth/facebook",
        contentType: "application/json; charset=utf-8",
        headers: {
            //"Cache-Control": "no-cache"  // no-cache
            "Cache-Control": "max-age=0"
        },
        xhrFields: {
            withCredentials: true
        },
        // crossDomain: true,
        dataType: "json",
        data: JSON.stringify(data),
        type: "POST"
      });
  });
}


function fbLoginPrompt() {
  var dfd = $.Deferred();
  FB.login(
    function(x) {
      return facebookLoginOkHandler(x).then(dfd.resolve, dfd.reject);
    }, {
      return_scopes: true, // response should contain the scopes the user allowed
      scope: [
        // 'taggable_friends', // requires review.
        // invitable_friends NOTE: only for games with a fb Canvas presence, so don't use this
        'public_profile',
        'user_location',
        'user_friends',
        'email'
      ].join(',')
    });
  return dfd.promise();
}


function connect() {
  var dfd = $.Deferred();
  if (FB.getAuthResponse()) {
    FB.getLoginStatus(function(x) {
      if (x.status === "connected") {
        facebookLoginOkHandler(x /*, password */).then(dfd.resolve, dfd.reject);
      } else {
        // this code path may trigger popup blockers.
        // ideally the fbLoginPrompt call below is called instead.
        fbLoginPrompt().then(dfd.resolve, dfd.reject);
      }
    });
  } else {
    // test for FB.getUserID() so we can show the prompt on the same stack, preventing the popup-blocker from showing.
    fbLoginPrompt().then(dfd.resolve, dfd.reject);
  }
  return dfd.promise();
}

$(function() {
  $(".facebookButton").on("click", function() {
    connect().then(function() {
      // that.model.set("response", "fbdone");
      // location.reload();
      window.location = "/inbox";
    }, function(err) {
      // alert("facebook error");
    });
  });
});


</script>


<!-- facebook code for share link -->
<div id="fb-root"></div>
<script>(function(d, s, id) {
var js, fjs = d.getElementsByTagName(s)[0];
if (d.getElementById(id)) return;
js = d.createElement(s); js.id = id;
js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&appId=661042417336977&version=v2.0";
fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>


<link href='https://fonts.googleapis.com/css?family=Montserrat:400,700|Cardo' rel='stylesheet' type='text/css'>


<script>
  $(document).ready(function(){
    $('#GetPolisAnimatedContainer').click(function(){
      $(this).animate({width: "290px"}, 400)
              .animate({height: "270px"}, 500, function(){
                $('#GetPolisAnimatedContainer').css({"cursor": "default"})
                $('#GetPolisFacebookEmail').fadeIn();
                $('html, body').animate({
                   scrollTop: $(document).height()-$(window).height()},
                   400
                );
              })
      $('#GetPolisAnimatedText').fadeOut();
      $('#BillionsFree').css({"visibility":"hidden"});
    })
  })
</script>


<div style="text-align: right;">
  <ul>
    <li class="header" style="
          position: relative;
          top: 7px;
      ">
      <a id="polisPlusLink" href="#" class="navIcon icon--login BillionsText HeaderLink">
        <img src="https://pol.is/landerImages/logo_white3.png" style="width: 88px;">
        <span style="
            color: rgb(106, 199, 106);
            font-size: 11px;
            position: relative;
            top: -18px;
            left: 2px;
        "> plus </span>
      </a>
    </li>
    <li class="header">
      <a class="navIcon BillionsText HeaderLink" href="https://pol.is/2arcefpshi" target="_blank">Demo</a>
    </li>
    <li style="display:none"  class="ifNoAuth header">
      <a class="navIcon icon--login BillionsText HeaderLink" href="/user/login">Login</a>
    </li>
    <li style="display:none"  class="ifAuth header">
      <a class="navIcon icon--inbox BillionsText HeaderLink" href="/inbox">Inbox</a>
    </li>
  {{!--   <li style="display:none"  class="ifAuth">
      <a class="navIcon icon--settings" href="/settings">Settings</a>
    </li> --}}
    <li style="display:none"  class="ifAuth header">
      <a class="navIcon icon--signout BillionsText HeaderLink" href="/user/logout/about">Signout</a>
    </li>
  </ul>
</div>

<script>
$("#polisPlusLink").on("click", function() {
  $.get("/api/v3/dummyButton?button=polisPlusLinkFromBillions");
});
</script>
<div id="billionsContainer">
  <p id="BillionsHeader" class="BillionsText"> TEN BILLION VOICES </p>

  <p id="BillionsSubHeader" class="BillionsText"> The internet has scaled up our ability to talk. Polis scales up our ability to listen.</p>

  <p id="BillionsExplainer"> Polis is a new kind of commenting system radically enhanced with machine learning and real-time data visualization. Use it to get better bottom up feedback and host online discussions that scale effectively. </p>
  <div id="GetPolisAnimatedContainer" class="BillionsText">
    <p id="GetPolisAnimatedText" > GET POLIS </p>
    <div id="GetPolisFacebookEmail" style="display:none">
      <button class="facebookButton">
        <i class="fa fa-facebook-square"></i>&nbsp; Sign Up With Facebook
      </button>
      <form class="FormHorizontal" style="text-align: center; margin: 20px auto 30px;" role="form">
        <div class="FormHorizontal-group">
          <label class="FormLabel">
          <p id="errorParagraph"> Sign up with email </p>
          </label>
          <input type="email" id="startconvo_email" placeholder="name@organization.com" class="FormControl">
          <br>
          <p><button type="submit" id="startconvo_submitbutton"
          class="Btn Btn-primary">Submit</button></p>
        </div>
      </form>
      <div class="errorDiv">
      </div>
    </div>
  </div>
  <p id="BillionsFree"> free </p>

  <div id="successModal" style="display:none;">
    <p style="font-family: Montserrat;text-align: center;width: 200px;margin: auto;font-size: 14px;color: white;background-color: rgba(100, 213, 119, 0.66);padding: 15px;line-height: 1.7;border-radius: 0px;margin-top: 20px;">
      <strong> Welcome! </strong> We've emailed you a confirmation. Follow the link provided in the email to verify your account.
    </p>
  </div>



<!-- prefetch icons -->
<i style="visibility:hidden" class="fa fa-facebook-square"></i>


<script>
  ga('send', 'event', 'Lander', 'land', 'general');


$(document).ready(function() {
  $("form").submit(function(e){
    e.preventDefault();
        e.stopPropagation();
    var email = $(this).find('#startconvo_email').val();

    if (!email) {
      $('').html();
    }

    var prod = "https://pol.is/";
    var preprod = "https://preprod.pol.is/";
    var embed = "https://embed.pol.is/";
    var survey = "https://survey.pol.is/";
    var polisio = "https://www.polis.io/";
    var localhost = "http://localhost:5000/";
    var localhost8000 = "http://localhost:8000/";
    var urlPrefix = prod;
    if (document.domain.indexOf("preprod") >= 0) {
        urlPrefix = preprod;
    }
    if (document.domain.indexOf("embed") >= 0) {
        urlPrefix = embed;
    }
    if (document.domain.indexOf("survey") >= 0) {
        urlPrefix = survey;
    }
    if (document.domain.indexOf("polis.io") >= 0) {
          urlPrefix = polisio;
    }
    if ((-1 === document.domain.indexOf("pol.is")) && (-1 === document.domain.indexOf("polis.io"))) {
        urlPrefix = localhost;
    }
    if (document.domain === "localhost" && document.location.port === "8000") {
      urlPrefix = localhost8000;
    }

        $.ajax({
          type: "POST",
          url: urlPrefix + "api/v3/einvites",
          contentType: "application/json; charset=utf-8",
          headers: {
              //"Cache-Control": "no-cache" // no-cache
              "Cache-Control": "max-age=0"
          },
          xhrFields: {
              withCredentials: true
          },
          crossDomain: true,
          dataType: "json",
          data: JSON.stringify({
            email: email
          })
        }).done(function( data ) {
            $("#GetPolisAnimatedContainer").hide();
            $("#successModal").show()
            ga("send", "event", "SignUp", "emailSubmitted", "general");
        }).fail(function(){
            ga("send", "event", "SignUp", "emailSubmitFail");
            $("#GetPolisAnimatedContainer").css({"border-color":"rgb(182, 40, 40)"});
            $("#errorParagraph").text("Please try again");
        });
        return false;
})
});
</script>








<script type="text/javascript">



</script>

</body>
</html>